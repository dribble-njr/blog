import{_ as c,c as l,a as n,e as i,b as t,d as s,w as u,r as e,o as r}from"./app-HGC3Yy25.js";const k={},d={class:"hint-container info"},v={href:"https://codesandbox.io/p/sandbox/image-annotation-pht676?file=%2Fsrc%2FApp.js%3A210%2C56",target:"_blank",rel:"noopener noreferrer"};function m(b,a){const o=e("ExternalLinkIcon"),p=e("CodeDemo");return r(),l("div",null,[n("div",d,[a[2]||(a[2]=n("p",{class:"hint-container-title"},"相关信息",-1)),n("p",null,[a[1]||(a[1]=s("demo: ")),n("a",v,[a[0]||(a[0]=s("https://codesandbox.io/p/sandbox/image-annotation-pht676?file=%2Fsrc%2FApp.js%3A210%2C56")),t(o)])])]),a[4]||(a[4]=i(`<p>实现图片批注有两种方案，一种是通过 <code>SVG</code> 绘制，一种是通过 <code>Canvas</code> 绘制。以下是两者对比：</p><table><thead><tr><th>特点</th><th>Canvas</th><th>SVG</th></tr></thead><tbody><tr><td>控制级别</td><td>像素级控制</td><td>矢量图形级别控制</td></tr><tr><td>编辑操作</td><td>难以直接编辑已绘制的元素</td><td>易于访问、操作和编辑 DOM 中的元素</td></tr><tr><td>图形类型</td><td>更适合复杂绘图和动画</td><td>适合简单图形和图标</td></tr><tr><td>性能</td><td>处理大量图形和复杂交互时性能较好</td><td>处理大规模动态变化时性能较差</td></tr><tr><td>可保存状态</td><td>绘制后的图像可以保存为图片</td><td>图像以 XML 格式保存，易于修改和存储</td></tr><tr><td>适用场景</td><td>复杂交互和动态绘制</td><td>静态或少量动态变化的图形</td></tr></tbody></table><p>综上，选择使用 <code>Canvas</code> 实现图片批注。</p><h2 id="加载图片" tabindex="-1"><a class="header-anchor" href="#加载图片"><span>加载图片</span></a></h2><p>实现图片批注的第一步是加载图片，这里使用 <code>FileReader</code> 读取图片文件，然后将图片绘制到 <code>Canvas</code> 上。</p><p>这里需要注意的是图片绘制位置，如果图片的宽高比和容器的宽高比不一致，需要根据图片和容器的比例调整绘制位置和大小。</p><div class="hint-container warning"><p class="hint-container-title">注意</p><p>这里需要存储当前图片，以便后续绘制批注时使用。</p></div><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">fillImage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  reader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 保存图片副本</span>
    imgRef<span class="token punctuation">.</span>current <span class="token operator">=</span> img
    img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">drawImageInCanvas</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    img<span class="token punctuation">.</span>src <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    reader<span class="token punctuation">.</span><span class="token function">readAsDataURL</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">drawImageInCanvas</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">img</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">current</span><span class="token operator">:</span> canvas <span class="token punctuation">}</span> <span class="token operator">=</span> canvasRef
  <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">current</span><span class="token operator">:</span> wrap <span class="token punctuation">}</span> <span class="token operator">=</span> wrapRef

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>canvas <span class="token operator">||</span> <span class="token operator">!</span>wrap<span class="token punctuation">)</span> <span class="token keyword">return</span>

  <span class="token keyword">const</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;2d&#39;</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> imgWidth <span class="token operator">=</span> img<span class="token punctuation">.</span>width
  <span class="token keyword">const</span> imgHeight <span class="token operator">=</span> img<span class="token punctuation">.</span>height
  <span class="token keyword">const</span> wrapWidth <span class="token operator">=</span> wrap<span class="token punctuation">.</span>offsetWidth
  <span class="token keyword">const</span> wrapHeight <span class="token operator">=</span> wrap<span class="token punctuation">.</span>offsetHeight

  <span class="token comment">// 如果图片的宽高都小于容器的宽高，则保留图片原始尺寸</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>imgWidth <span class="token operator">&lt;=</span> wrapWidth <span class="token operator">&amp;&amp;</span> imgHeight <span class="token operator">&lt;=</span> wrapHeight<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> imgWidth
    canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> imgHeight
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> wrapWidth
    canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> wrapHeight

    <span class="token keyword">const</span> imgRatio <span class="token operator">=</span> imgWidth <span class="token operator">/</span> imgHeight
    <span class="token keyword">const</span> wrapRatio <span class="token operator">=</span> wrapWidth <span class="token operator">/</span> wrapHeight

    <span class="token comment">// 根据图片和容器的比例关系进行调整</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>imgRatio <span class="token operator">&gt;=</span> wrapRatio<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> wrapWidth <span class="token operator">/</span> imgRatio
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> wrapHeight <span class="token operator">*</span> imgRatio
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 绘制图像到 Canvas</span>
  ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="绘制批注" tabindex="-1"><a class="header-anchor" href="#绘制批注"><span>绘制批注</span></a></h2><p>定义 <code>Annotation</code> 类型，用于描述批注的类型、颜色和坐标点。目前 <code>type</code> 只支持 <code>line</code> 和 <code>rectangle</code> 两种类型，<code>points</code> 为坐标点数组，数组长度为 <code>2</code>，分别表示起点和终点。</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">interface</span> <span class="token class-name">Annotation</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">&#39;line&#39;</span> <span class="token operator">|</span> <span class="token string">&#39;rectangle&#39;</span>
  color<span class="token operator">:</span> <span class="token builtin">string</span>
  points<span class="token operator">:</span> Point<span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">Point</span> <span class="token punctuation">{</span>
  x<span class="token operator">:</span> <span class="token builtin">number</span>
  y<span class="token operator">:</span> <span class="token builtin">number</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>实现绘制批注的方法 <code>drawAnnotations</code>，遍历 <code>annotations</code> 数组，根据 <code>type</code> 绘制批注。</p><p>同时需要加入一个 <code>annotationMode</code> 状态，用于表示当前绘制的批注类型，当 <code>annotationMode</code> 变化时，重新绘制批注。</p><div class="hint-container warning"><p class="hint-container-title">注意</p><p>下面两个代码是关键，不能省去，否则在绘制时会出现拖影及图片消失问题。</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// 绘制前清空 Canvas</span>
ctx<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvasRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvasRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span>height<span class="token punctuation">)</span>
<span class="token comment">// 重新绘制图片</span>
<span class="token function">drawImageInCanvas</span><span class="token punctuation">(</span>imgRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">drawAnnotations</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>annotationMode<span class="token punctuation">)</span> <span class="token keyword">return</span>

  <span class="token keyword">const</span> ctx <span class="token operator">=</span> canvasRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;2d&#39;</span><span class="token punctuation">)</span>
  <span class="token comment">// 绘制前清空 Canvas</span>
  ctx<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvasRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvasRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span>height<span class="token punctuation">)</span>
  <span class="token comment">// 重新绘制图片</span>
  <span class="token function">drawImageInCanvas</span><span class="token punctuation">(</span>imgRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span>

  annotations<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">annotation</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> annotation<span class="token punctuation">.</span>color
    <span class="token comment">// 根据 annotation.type 绘制批注</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>annotation<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">&#39;line&#39;</span><span class="token operator">:</span>
        <span class="token comment">// 绘制线条</span>
        ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        ctx<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>annotation<span class="token punctuation">.</span>points<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> annotation<span class="token punctuation">.</span>points<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span>
        ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>annotation<span class="token punctuation">.</span>points<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> annotation<span class="token punctuation">.</span>points<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span>
        ctx<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>
      <span class="token keyword">case</span> <span class="token string">&#39;rectangle&#39;</span><span class="token operator">:</span>
        <span class="token comment">// 绘制矩形框</span>
        ctx<span class="token punctuation">.</span><span class="token function">strokeRect</span><span class="token punctuation">(</span>
          annotation<span class="token punctuation">.</span>points<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span>
          annotation<span class="token punctuation">.</span>points<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span>
          annotation<span class="token punctuation">.</span>points<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">-</span> annotation<span class="token punctuation">.</span>points<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span>
          annotation<span class="token punctuation">.</span>points<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">-</span> annotation<span class="token punctuation">.</span>points<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y
        <span class="token punctuation">)</span>
        <span class="token keyword">break</span>
      <span class="token comment">// 其他类型的批注...</span>
      <span class="token keyword">default</span><span class="token operator">:</span>
        <span class="token keyword">break</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">drawAnnotations</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>annotations<span class="token punctuation">,</span> annotationMode<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="记录起点终点" tabindex="-1"><a class="header-anchor" href="#记录起点终点"><span>记录起点终点</span></a></h2><p>定义 <code>isDrawing</code>、<code>startPoint</code> 和 <code>endPoint</code> 状态，用于记录是否正在绘制、起点和终点坐标。</p><p>在 <code>mousedown</code> 事件中记录起点信息，在 <code>mousemove</code> 事件中记录终点信息，然后在 <code>mouseup</code> 事件中将批注信息添加到 <code>annotations</code> 数组中。</p><div class="hint-container warning"><p class="hint-container-title">注意</p><p><code>mousemove</code> 事件中需要重复绘制批注信息。</p></div><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">[</span>isDrawing<span class="token punctuation">,</span> setIsDrawing<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token comment">// 是否正在绘制</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>startPoint<span class="token punctuation">,</span> setStartPoint<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 绘制起点</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>endPoint<span class="token punctuation">,</span> setEndPoint<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 绘制终点</span>

<span class="token comment">// 鼠标点击事件处理程序</span>
<span class="token keyword">const</span> <span class="token function-variable function">handleMouseDown</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>annotationMode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setIsDrawing</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>

  <span class="token function">setIsDrawing</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> canvas <span class="token operator">=</span> canvasRef<span class="token punctuation">.</span>current
  <span class="token keyword">const</span> rect <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token function">setStartPoint</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">x</span><span class="token operator">:</span> e<span class="token punctuation">.</span>clientX <span class="token operator">-</span> rect<span class="token punctuation">.</span>left<span class="token punctuation">,</span>
    <span class="token literal-property property">y</span><span class="token operator">:</span> e<span class="token punctuation">.</span>clientY <span class="token operator">-</span> rect<span class="token punctuation">.</span>top
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 鼠标移动事件处理程序</span>
<span class="token keyword">const</span> <span class="token function-variable function">handleMouseMove</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>annotationMode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setIsDrawing</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isDrawing<span class="token punctuation">)</span> <span class="token keyword">return</span>

  <span class="token keyword">const</span> canvas <span class="token operator">=</span> canvasRef<span class="token punctuation">.</span>current
  <span class="token keyword">const</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;2d&#39;</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> rect <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> currentX <span class="token operator">=</span> e<span class="token punctuation">.</span>clientX <span class="token operator">-</span> rect<span class="token punctuation">.</span>left
  <span class="token keyword">const</span> currentY <span class="token operator">=</span> e<span class="token punctuation">.</span>clientY <span class="token operator">-</span> rect<span class="token punctuation">.</span>top

  <span class="token function">drawAnnotations</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// 绘制当前批注的预览效果</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>annotationMode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">&#39;line&#39;</span><span class="token operator">:</span>
      ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      ctx<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>startPoint<span class="token punctuation">.</span>x<span class="token punctuation">,</span> startPoint<span class="token punctuation">.</span>y<span class="token punctuation">)</span>
      ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>currentX<span class="token punctuation">,</span> currentY<span class="token punctuation">)</span>
      ctx<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">break</span>
    <span class="token keyword">case</span> <span class="token string">&#39;rectangle&#39;</span><span class="token operator">:</span>
      <span class="token keyword">const</span> width <span class="token operator">=</span> currentX <span class="token operator">-</span> startPoint<span class="token punctuation">.</span>x
      <span class="token keyword">const</span> height <span class="token operator">=</span> currentY <span class="token operator">-</span> startPoint<span class="token punctuation">.</span>y
      ctx<span class="token punctuation">.</span><span class="token function">strokeRect</span><span class="token punctuation">(</span>startPoint<span class="token punctuation">.</span>x<span class="token punctuation">,</span> startPoint<span class="token punctuation">.</span>y<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span>
      <span class="token keyword">break</span>
    <span class="token comment">// 其他类型的批注...</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">break</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 实时更新终点坐标</span>
  <span class="token function">setEndPoint</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> currentX<span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> currentY <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 鼠标释放事件处理程序</span>
<span class="token keyword">const</span> <span class="token function-variable function">handleMouseUp</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>annotationMode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setIsDrawing</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>isDrawing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setIsDrawing</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>

    <span class="token comment">// 更新终点坐标</span>
    <span class="token keyword">const</span> canvas <span class="token operator">=</span> canvasRef<span class="token punctuation">.</span>current
    <span class="token keyword">const</span> rect <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> mouseX <span class="token operator">=</span> e<span class="token punctuation">.</span>clientX <span class="token operator">-</span> rect<span class="token punctuation">.</span>left
    <span class="token keyword">const</span> mouseY <span class="token operator">=</span> e<span class="token punctuation">.</span>clientY <span class="token operator">-</span> rect<span class="token punctuation">.</span>top
    <span class="token function">setEndPoint</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> mouseX<span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> mouseY <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// 将绘制的信息添加到 annotations 状态中</span>
    <span class="token function">setAnnotations</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token operator">...</span>annotations<span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> annotationMode<span class="token punctuation">,</span>
        <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&#39;red&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">points</span><span class="token operator">:</span> <span class="token punctuation">[</span>startPoint<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> mouseX<span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> mouseY <span class="token punctuation">}</span><span class="token punctuation">]</span>
        <span class="token comment">// 可以添加其他所需信息</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 添加事件监听器</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">current</span><span class="token operator">:</span> canvas <span class="token punctuation">}</span> <span class="token operator">=</span> canvasRef
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>canvasRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span> <span class="token keyword">return</span>
  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;mousedown&#39;</span><span class="token punctuation">,</span> handleMouseDown<span class="token punctuation">)</span>
  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;mousemove&#39;</span><span class="token punctuation">,</span> handleMouseMove<span class="token punctuation">)</span>
  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;mouseup&#39;</span><span class="token punctuation">,</span> handleMouseUp<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    canvas<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;mousedown&#39;</span><span class="token punctuation">,</span> handleMouseDown<span class="token punctuation">)</span>
    canvas<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;mousemove&#39;</span><span class="token punctuation">,</span> handleMouseMove<span class="token punctuation">)</span>
    canvas<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;mouseup&#39;</span><span class="token punctuation">,</span> handleMouseUp<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>annotations<span class="token punctuation">,</span> annotationMode<span class="token punctuation">,</span> isDrawing<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="图片缩放" tabindex="-1"><a class="header-anchor" href="#图片缩放"><span>图片缩放</span></a></h2><p>使用 <code>zoomFactorRef</code> 保存实时缩放比例（使用 state 会拿不到最新值）。监听缩放系数，设置 <code>canvas</code> 的样式实现缩放。</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> zoomFactorRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment">// 监听鼠标滚轮事件</span>
<span class="token keyword">const</span> <span class="token function-variable function">handleMouseWheel</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> deltaY <span class="token punctuation">}</span> <span class="token operator">=</span> e
  <span class="token keyword">const</span> newScale <span class="token operator">=</span>
    deltaY <span class="token operator">&gt;</span> <span class="token number">0</span>
      <span class="token operator">?</span> <span class="token punctuation">(</span>zoomFactorRef<span class="token punctuation">.</span>current <span class="token operator">*</span> <span class="token number">10</span> <span class="token operator">-</span> <span class="token number">0.1</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">10</span>
      <span class="token operator">:</span> <span class="token punctuation">(</span>zoomFactorRef<span class="token punctuation">.</span>current <span class="token operator">*</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">0.1</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">10</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>newScale <span class="token operator">&lt;</span> <span class="token number">0.1</span> <span class="token operator">||</span> newScale <span class="token operator">&gt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">return</span>
  zoomFactorRef<span class="token punctuation">.</span>current <span class="token operator">=</span> newScale
<span class="token punctuation">}</span>

<span class="token comment">//监听缩放画布</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">current</span><span class="token operator">:</span> canvas <span class="token punctuation">}</span> <span class="token operator">=</span> canvasRef
  canvas <span class="token operator">&amp;&amp;</span>
    <span class="token punctuation">(</span>canvas<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">scale(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>zoomFactorRef<span class="token punctuation">.</span>current<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>zoomFactorRef<span class="token punctuation">.</span>current<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>zoomFactorRef<span class="token punctuation">.</span>current<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="最终代码" tabindex="-1"><a class="header-anchor" href="#最终代码"><span>最终代码</span></a></h2><p>最终代码如下，还存在优化的空间，比如批注历史信息、撤销、重做等。</p>`,25)),t(p,{id:"code-demo-157",type:"react",title:"%E5%9B%BE%E7%89%87%E6%89%B9%E6%B3%A8",code:"eJy1WW1vG8cR/isbtTAplz7JKfqFEFUkso0aiIHAjpGkloGc7pbkxcc74u6olzACnNixZcuJ3NZO/B4pbWMFbSQVThVbtOw/oztKn/IXMvtye7vHO4oyYkGQuLszs7PPzj4zu2wPfewPlYcM1/ED1EYtH58J9ACXyKfTuEr/H69WsRGgeVRBp7FuBJPOpINnm64XIBNX9ZYdoOIwqoyj9qSDEDM14+lN0AcVZqjotGx7OBk3dGda97MkEplzuuO44I0FrRLycfBW0j7P9KizxXPnJcuS1inXhJUoiqRL0ZU0rUZtH4cs/5inz1hOjVo9GbcUg1Xd9vEwGhlB0Z318Ob30Y//DB+sdjt3woVNyZQf6F7wrms5AbUFurypGGuj2TIaLaE5+IvmqVVmaff/P3c/fybZw46ZWDvOG4PZ6nYWVFufuG7jBGy061FrfxVNxd5RZuL5D9GtF90nnej2RmIisaAgmqWSKFUt2z7Z0GsYFIrQABTjoIpFPKyb2INxB8+gEyACAQkdZBeZGBPQXMd2dZPYUYxIO81t0PlYEJAfFgKa0fI87AQgAx3SmGRXNYuQCaFAjZ10JmhsF0Fe2J2XjfieARawBltew4HmYR+OEBMAOfbBqsYQiDn40si/t/xjeqCfPf0OkxG6wgBbZo9PxHHiVg+ubcSXXOYnk552cUhzRMkhp4L8tMvOv8HtfPopeoMMD4P/QcsDCdmYEcyKeTQAY8J1AjwbFAtvmgWxp2LP3rfMoM42RZshn1Pjf8FWrc53TavThixB3IhNkM+aW61CeNOutJwwJQmyvtgrCOTw+8+jRw/C+y+61652710O17b3/nNn79J2uLG0s/VVuPYsvLsq+n95fiNcuLvz8mH39l2mEn71bfh4MdzYCtefJsCJdY6xyVnj0CFpgXyEtaQI4ThSaBgK0trEMAOGjcdLovGDMDBXrjXhS565xKUYIplYCftKPqGR9PRK5uDSyfpHMs0Tkl1+Fn25xgH9+w0BerR+a+fFYvjFE+CZ3Zf3d1du7G5cim7/JA4ig5rNNM5DmDQkPLPXKPlPFcQZT+GXiSDfwcO92ikCEOwMSwsvLYULG4idYR6pwawmjjdZSIlQO/zKc4oW85/yhEIQdd0xbUxtTMBnxrwKYwpOLgq+IpTjnxtlORel8nKci3t4SJJJ0yelCzVr788WEk1nEEcMkWFjHVKQERRldGRdBSh5QMIsh90lacFVUsmiVV3vuG7Ui8WkM5WMwEM/8NwLkFHnbAJ+IqkZru16PYEuSwRzTcyDJLr2LHqyGkv7M1Zg1JE0L5VNRTbEasG2HFwoJ71S3HW3XkYPV+Qh4u4UrlnOu3pQT3JmPNRwp/F7rjxpk9QgJFS02ZLseNI/12OFeJRp5WiOFejvtcJQVX2cgsx5IQ2AB7EBgW/novDtD+H2d9HKlewZaGjJQ3IEKOsfQGhuXyGCATryqlMQpPK052TlfrCRtPfF5k7n6+7/OuGjRcK0NPY0TZOKIXYtUCBV7MRsJ3OFuGkUFXZIkQfb0/lS6nag0gfhICIGzu49X46Wr0J9G17t7Gwt7nQ2w39d7t680l1dDLeW0lR4ygUvjrkzTg8RZpKUOE/ybYDfAJKyjRGZwu6KfOC1YnH5cpRFdWotDJcyuXh62205JhicsC0QpaEpeEm5YhSF33AjwECSRP4DCA1iUrNxNRCxBJeFWODDWCBwmxnbl2D9uBNeXx0Q61NAGq8Na2FL3Nty8spAeO9Tqx54YyTLbLIP6K0gYzcyZD+UZNWNyT016bpi+x/htS/Z4YVTvPfd5d3HC9HtBahoecj0ZJHURmSnkNwsIeWI5PJLOF1qyUwuZYMYIMjTfPkpuV6+V+imD9fzopOXaGInjshezabFRT0odkORl8g0lSryF15iPpS47byVDEC/veQrWZDry3DtUfTNZnT/p+jrDfYGED68CQdYMEb8jMCeDpJNAFIQC8/mgL2r1+GKPyAHnG2+ZraltX5CAf3tyCVXDjSD8sYrEEKs0iDA7EMIimw+IYi1qtvJZqCbyQ2QrZTjbOMKr4HuXd55uRJ9th79DMy+TK4iUu5F3eub0cXPdp7+KE2l3AiSQIQolbN2MiAVpgiRWrWcyuhKcUNL4zI50GZBGWD1TFl9Xctb7flUwRcure90/s3XSM9YdO3i3oOLbO2JsHjLiW9A8sMLodf7fwtv/pedg6hzb3d7jZ2DzNh/v46x3RP+WGt6eBp28hg7y2q6aMMRtwMdlkD2XB6BF60zhk5uEgkZUMlxNJos4M+oqLzPieeuw+joKITOqHaUfoTHOvib6JX76v0hU48cPeHVGBWBFyHRM47eTFIyj53kuVFo8uVnz04f8qiYsg9sG/hb461O+PRSnyLzIK9gbOTQoRiYIj/XPrnDaYGnOz7c/Bqg+ZFPvCr+vp3p+Hwpb2D4I1HkZgrE5e1vsJj9n/RSD3rypVfZOY6CbprHSeS+Y/kBduBptkDPmwk1dQGSm1plx2HdV5XUDKoqKRoHUm01VcWzTa5GX/V6lWbIaVRV6AGVnpfJgtOvv9wJj7p64NUPoN8XggH0c3HgSGRq9gEjYb3+97ASEmk3jlmZAdWvZXJeoIiCCwfLdmvJG9S0brcwEFmqo4wgr+IqFI1mCRVYZRStroTPl+IKvefLoIPYlEudOBKY2bHxGM8x05pOKNPD1UqbHyWRN8ALQhWVtpL1TMtv2jrkp0LVxrNqXvu45QdWdY7eOMgpLRjwD3uqkG5bNedkgBuQADMFWGUJg38cHW2mZqDFJwz9qXdoSjcu1DxSsUzwvPs7bGJcHS1IOVEsTgABUHDeoSAI9phHIwlYI4BW0qpa2DZhhwQ+aMqdPWN9AuEDs065Hnz/cQS6ICi5v+BuCTVguyznPbdZJnlofl52wcY1+GZsnL0Ps4AYG+GdSbXDti2Zlll82w0Ct9FrFKQtp9kSVRj7IVVLZXLI00141B1SxywTRhzXwekBR28QJaKbHqLRV2mL4JPCh/wYdWxcwGalrZ44VKnAt205Oq7DzlilnX/+FJVkpxiY+hQUK/WgYZ9wPbGi8eibZcCUjCmQviJM5Mp3YJiy1fphxO6trxkg5tQ4PKX+hgCJa+wroJSr2xeq5OL8mvGS3BuHN9cENKHBCUPqoRDGqJHvJiaHkG4YuBlA2yJv9iOHoSvtqvSlh8pIMQnxrjE2BtQPCxma/xVpoG2C"},{default:u(()=>a[3]||(a[3]=[n("div",{class:"language-javascript line-numbers-mode","data-ext":"js","data-title":"js"},[n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token punctuation"},"{"),s(" useState"),n("span",{class:"token punctuation"},","),s(" useRef"),n("span",{class:"token punctuation"},","),s(" useEffect "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token operator"},"="),s(` React

`),n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"default"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"const"),s(" wrapRef "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"useRef"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"null"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token keyword"},"const"),s(" canvasRef "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"useRef"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"null"),n("span",{class:"token punctuation"},")"),s(`

  `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token punctuation"},"["),s("annotations"),n("span",{class:"token punctuation"},","),s(" setAnnotations"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"useState"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token punctuation"},"["),s("annotationMode"),n("span",{class:"token punctuation"},","),s(" setAnnotationMode"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"useState"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token keyword"},"const"),s(" imgRef "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"useRef"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"null"),n("span",{class:"token punctuation"},")"),s(`

  `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token punctuation"},"["),s("isDrawing"),n("span",{class:"token punctuation"},","),s(" setIsDrawing"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"useState"),n("span",{class:"token punctuation"},"("),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token comment"},"// 是否正在绘制"),s(`
  `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token punctuation"},"["),s("startPoint"),n("span",{class:"token punctuation"},","),s(" setStartPoint"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"useState"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token literal-property property"},"x"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token literal-property property"},"y"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"0"),s(),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token comment"},"// 绘制起点"),s(`
  `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token punctuation"},"["),s("endPoint"),n("span",{class:"token punctuation"},","),s(" setEndPoint"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"useState"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token literal-property property"},"x"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token literal-property property"},"y"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"0"),s(),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token comment"},"// 绘制终点"),s(`
  `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token punctuation"},"["),s("zoomFactor"),n("span",{class:"token punctuation"},","),s(" setZoomFactor"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"useState"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token comment"},"// 缩放系数"),s(`
  `),n("span",{class:"token keyword"},"const"),s(" zoomFactorRef "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"useRef"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token comment"},"// 缩放系数"),s(`

  `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token function-variable function"},"fillImage"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"file"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" reader "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"FileReader"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`

    reader`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function-variable function"},"onload"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"e"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token keyword"},"const"),s(" img "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Image"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
      imgRef`),n("span",{class:"token punctuation"},"."),s("current "),n("span",{class:"token operator"},"="),s(` img
      img`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function-variable function"},"onload"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token function"},"drawImageInCanvas"),n("span",{class:"token punctuation"},"("),s("img"),n("span",{class:"token punctuation"},")"),s(`
      `),n("span",{class:"token punctuation"},"}"),s(`
      img`),n("span",{class:"token punctuation"},"."),s("src "),n("span",{class:"token operator"},"="),s(" e"),n("span",{class:"token punctuation"},"."),s("target"),n("span",{class:"token punctuation"},"."),s(`result
    `),n("span",{class:"token punctuation"},"}"),s(`

    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("file"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
      reader`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"readAsDataURL"),n("span",{class:"token punctuation"},"("),s("file"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token function-variable function"},"drawImageInCanvas"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"img"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token literal-property property"},"current"),n("span",{class:"token operator"},":"),s(" canvas "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token operator"},"="),s(` canvasRef
    `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token literal-property property"},"current"),n("span",{class:"token operator"},":"),s(" wrap "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token operator"},"="),s(` wrapRef

    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"!"),s("canvas "),n("span",{class:"token operator"},"||"),s(),n("span",{class:"token operator"},"!"),s("wrap"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"return"),s(`

    `),n("span",{class:"token keyword"},"const"),s(" ctx "),n("span",{class:"token operator"},"="),s(" canvas"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getContext"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'2d'"),n("span",{class:"token punctuation"},")"),s(`

    `),n("span",{class:"token keyword"},"const"),s(" imgWidth "),n("span",{class:"token operator"},"="),s(" img"),n("span",{class:"token punctuation"},"."),s(`width
    `),n("span",{class:"token keyword"},"const"),s(" imgHeight "),n("span",{class:"token operator"},"="),s(" img"),n("span",{class:"token punctuation"},"."),s(`height
    `),n("span",{class:"token keyword"},"const"),s(" wrapWidth "),n("span",{class:"token operator"},"="),s(" wrap"),n("span",{class:"token punctuation"},"."),s(`offsetWidth
    `),n("span",{class:"token keyword"},"const"),s(" wrapHeight "),n("span",{class:"token operator"},"="),s(" wrap"),n("span",{class:"token punctuation"},"."),s(`offsetHeight

    `),n("span",{class:"token comment"},"// 如果图片的宽高都小于容器的宽高，则保留图片原始尺寸"),s(`
    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("imgWidth "),n("span",{class:"token operator"},"<="),s(" wrapWidth "),n("span",{class:"token operator"},"&&"),s(" imgHeight "),n("span",{class:"token operator"},"<="),s(" wrapHeight"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
      canvas`),n("span",{class:"token punctuation"},"."),s("width "),n("span",{class:"token operator"},"="),s(` imgWidth
      canvas`),n("span",{class:"token punctuation"},"."),s("height "),n("span",{class:"token operator"},"="),s(` imgHeight
    `),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{"),s(`
      canvas`),n("span",{class:"token punctuation"},"."),s("width "),n("span",{class:"token operator"},"="),s(` wrapWidth
      canvas`),n("span",{class:"token punctuation"},"."),s("height "),n("span",{class:"token operator"},"="),s(` wrapHeight

      `),n("span",{class:"token keyword"},"const"),s(" imgRatio "),n("span",{class:"token operator"},"="),s(" imgWidth "),n("span",{class:"token operator"},"/"),s(` imgHeight
      `),n("span",{class:"token keyword"},"const"),s(" wrapRatio "),n("span",{class:"token operator"},"="),s(" wrapWidth "),n("span",{class:"token operator"},"/"),s(` wrapHeight

      `),n("span",{class:"token comment"},"// 根据图片和容器的比例关系进行调整"),s(`
      `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("imgRatio "),n("span",{class:"token operator"},">="),s(" wrapRatio"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        canvas`),n("span",{class:"token punctuation"},"."),s("height "),n("span",{class:"token operator"},"="),s(" wrapWidth "),n("span",{class:"token operator"},"/"),s(` imgRatio
      `),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{"),s(`
        canvas`),n("span",{class:"token punctuation"},"."),s("width "),n("span",{class:"token operator"},"="),s(" wrapHeight "),n("span",{class:"token operator"},"*"),s(` imgRatio
      `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`

    `),n("span",{class:"token comment"},"// 绘制图像到 Canvas"),s(`
    ctx`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"drawImage"),n("span",{class:"token punctuation"},"("),s("img"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(" canvas"),n("span",{class:"token punctuation"},"."),s("width"),n("span",{class:"token punctuation"},","),s(" canvas"),n("span",{class:"token punctuation"},"."),s("height"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token function-variable function"},"handleImageChange"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"e"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token function"},"fillImage"),n("span",{class:"token punctuation"},"("),s("e"),n("span",{class:"token punctuation"},"."),s("target"),n("span",{class:"token punctuation"},"."),s("files"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token function"},"setAnnotations"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token function-variable function"},"drawAnnotations"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"!"),s("annotationMode"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"return"),s(`

    `),n("span",{class:"token keyword"},"const"),s(" ctx "),n("span",{class:"token operator"},"="),s(" canvasRef"),n("span",{class:"token punctuation"},"."),s("current"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getContext"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'2d'"),n("span",{class:"token punctuation"},")"),s(`
    ctx`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"clearRect"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(" canvasRef"),n("span",{class:"token punctuation"},"."),s("current"),n("span",{class:"token punctuation"},"."),s("width"),n("span",{class:"token punctuation"},","),s(" canvasRef"),n("span",{class:"token punctuation"},"."),s("current"),n("span",{class:"token punctuation"},"."),s("height"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token function"},"drawImageInCanvas"),n("span",{class:"token punctuation"},"("),s("imgRef"),n("span",{class:"token punctuation"},"."),s("current"),n("span",{class:"token punctuation"},")"),s(`

    annotations`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"forEach"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"annotation"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
      ctx`),n("span",{class:"token punctuation"},"."),s("strokeStyle "),n("span",{class:"token operator"},"="),s(" annotation"),n("span",{class:"token punctuation"},"."),s(`color
      `),n("span",{class:"token comment"},"// 根据 annotation.type 绘制批注"),s(`
      `),n("span",{class:"token keyword"},"switch"),s(),n("span",{class:"token punctuation"},"("),s("annotation"),n("span",{class:"token punctuation"},"."),s("type"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"case"),s(),n("span",{class:"token string"},"'line'"),n("span",{class:"token operator"},":"),s(`
          `),n("span",{class:"token comment"},"// 绘制线条"),s(`
          ctx`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"beginPath"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
          ctx`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"moveTo"),n("span",{class:"token punctuation"},"("),s("annotation"),n("span",{class:"token punctuation"},"."),s("points"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("x"),n("span",{class:"token punctuation"},","),s(" annotation"),n("span",{class:"token punctuation"},"."),s("points"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("y"),n("span",{class:"token punctuation"},")"),s(`
          ctx`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"lineTo"),n("span",{class:"token punctuation"},"("),s("annotation"),n("span",{class:"token punctuation"},"."),s("points"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("x"),n("span",{class:"token punctuation"},","),s(" annotation"),n("span",{class:"token punctuation"},"."),s("points"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("y"),n("span",{class:"token punctuation"},")"),s(`
          ctx`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"stroke"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
          `),n("span",{class:"token keyword"},"break"),s(`
        `),n("span",{class:"token keyword"},"case"),s(),n("span",{class:"token string"},"'rectangle'"),n("span",{class:"token operator"},":"),s(`
          `),n("span",{class:"token comment"},"// 绘制矩形框"),s(`
          ctx`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"strokeRect"),n("span",{class:"token punctuation"},"("),s(`
            annotation`),n("span",{class:"token punctuation"},"."),s("points"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("x"),n("span",{class:"token punctuation"},","),s(`
            annotation`),n("span",{class:"token punctuation"},"."),s("points"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("y"),n("span",{class:"token punctuation"},","),s(`
            annotation`),n("span",{class:"token punctuation"},"."),s("points"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("x "),n("span",{class:"token operator"},"-"),s(" annotation"),n("span",{class:"token punctuation"},"."),s("points"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("x"),n("span",{class:"token punctuation"},","),s(`
            annotation`),n("span",{class:"token punctuation"},"."),s("points"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("y "),n("span",{class:"token operator"},"-"),s(" annotation"),n("span",{class:"token punctuation"},"."),s("points"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s(`y
          `),n("span",{class:"token punctuation"},")"),s(`
          `),n("span",{class:"token keyword"},"break"),s(`
        `),n("span",{class:"token comment"},"// 其他类型的批注..."),s(`
        `),n("span",{class:"token keyword"},"default"),n("span",{class:"token operator"},":"),s(`
          `),n("span",{class:"token keyword"},"break"),s(`
      `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token function"},"useEffect"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token function"},"drawAnnotations"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"["),s("annotations"),n("span",{class:"token punctuation"},","),s(" annotationMode"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),s(`

  `),n("span",{class:"token comment"},"// 鼠标点击事件处理程序"),s(`
  `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token function-variable function"},"handleMouseDown"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"e"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"!"),s("annotationMode"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token function"},"setIsDrawing"),n("span",{class:"token punctuation"},"("),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},")"),s(`
      `),n("span",{class:"token keyword"},"return"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`

    `),n("span",{class:"token function"},"setIsDrawing"),n("span",{class:"token punctuation"},"("),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" canvas "),n("span",{class:"token operator"},"="),s(" canvasRef"),n("span",{class:"token punctuation"},"."),s(`current
    `),n("span",{class:"token keyword"},"const"),s(" rect "),n("span",{class:"token operator"},"="),s(" canvas"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getBoundingClientRect"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`

    `),n("span",{class:"token function"},"setStartPoint"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token literal-property property"},"x"),n("span",{class:"token operator"},":"),s(" e"),n("span",{class:"token punctuation"},"."),s("clientX "),n("span",{class:"token operator"},"-"),s(" rect"),n("span",{class:"token punctuation"},"."),s("left"),n("span",{class:"token punctuation"},","),s(`
      `),n("span",{class:"token literal-property property"},"y"),n("span",{class:"token operator"},":"),s(" e"),n("span",{class:"token punctuation"},"."),s("clientY "),n("span",{class:"token operator"},"-"),s(" rect"),n("span",{class:"token punctuation"},"."),s(`top
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token comment"},"// 鼠标移动事件处理程序"),s(`
  `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token function-variable function"},"handleMouseMove"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"e"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"!"),s("annotationMode"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token function"},"setIsDrawing"),n("span",{class:"token punctuation"},"("),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},")"),s(`
      `),n("span",{class:"token keyword"},"return"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"!"),s("isDrawing"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"return"),s(`

    `),n("span",{class:"token keyword"},"const"),s(" canvas "),n("span",{class:"token operator"},"="),s(" canvasRef"),n("span",{class:"token punctuation"},"."),s(`current
    `),n("span",{class:"token keyword"},"const"),s(" ctx "),n("span",{class:"token operator"},"="),s(" canvas"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getContext"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'2d'"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" rect "),n("span",{class:"token operator"},"="),s(" canvas"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getBoundingClientRect"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" currentX "),n("span",{class:"token operator"},"="),s(" e"),n("span",{class:"token punctuation"},"."),s("clientX "),n("span",{class:"token operator"},"-"),s(" rect"),n("span",{class:"token punctuation"},"."),s(`left
    `),n("span",{class:"token keyword"},"const"),s(" currentY "),n("span",{class:"token operator"},"="),s(" e"),n("span",{class:"token punctuation"},"."),s("clientY "),n("span",{class:"token operator"},"-"),s(" rect"),n("span",{class:"token punctuation"},"."),s(`top

    `),n("span",{class:"token function"},"drawAnnotations"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`

    `),n("span",{class:"token comment"},"// 绘制当前批注的预览效果"),s(`
    `),n("span",{class:"token keyword"},"switch"),s(),n("span",{class:"token punctuation"},"("),s("annotationMode"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token keyword"},"case"),s(),n("span",{class:"token string"},"'line'"),n("span",{class:"token operator"},":"),s(`
        ctx`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"beginPath"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
        ctx`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"moveTo"),n("span",{class:"token punctuation"},"("),s("startPoint"),n("span",{class:"token punctuation"},"."),s("x"),n("span",{class:"token punctuation"},","),s(" startPoint"),n("span",{class:"token punctuation"},"."),s("y"),n("span",{class:"token punctuation"},")"),s(`
        ctx`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"lineTo"),n("span",{class:"token punctuation"},"("),s("currentX"),n("span",{class:"token punctuation"},","),s(" currentY"),n("span",{class:"token punctuation"},")"),s(`
        ctx`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"stroke"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
        `),n("span",{class:"token keyword"},"break"),s(`
      `),n("span",{class:"token keyword"},"case"),s(),n("span",{class:"token string"},"'rectangle'"),n("span",{class:"token operator"},":"),s(`
        `),n("span",{class:"token keyword"},"const"),s(" width "),n("span",{class:"token operator"},"="),s(" currentX "),n("span",{class:"token operator"},"-"),s(" startPoint"),n("span",{class:"token punctuation"},"."),s(`x
        `),n("span",{class:"token keyword"},"const"),s(" height "),n("span",{class:"token operator"},"="),s(" currentY "),n("span",{class:"token operator"},"-"),s(" startPoint"),n("span",{class:"token punctuation"},"."),s(`y
        ctx`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"strokeRect"),n("span",{class:"token punctuation"},"("),s("startPoint"),n("span",{class:"token punctuation"},"."),s("x"),n("span",{class:"token punctuation"},","),s(" startPoint"),n("span",{class:"token punctuation"},"."),s("y"),n("span",{class:"token punctuation"},","),s(" width"),n("span",{class:"token punctuation"},","),s(" height"),n("span",{class:"token punctuation"},")"),s(`
        `),n("span",{class:"token keyword"},"break"),s(`
      `),n("span",{class:"token comment"},"// 其他类型的批注..."),s(`
      `),n("span",{class:"token keyword"},"default"),n("span",{class:"token operator"},":"),s(`
        `),n("span",{class:"token keyword"},"break"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`

    `),n("span",{class:"token comment"},"// 实时更新终点坐标"),s(`
    `),n("span",{class:"token function"},"setEndPoint"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token literal-property property"},"x"),n("span",{class:"token operator"},":"),s(" currentX"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token literal-property property"},"y"),n("span",{class:"token operator"},":"),s(" currentY "),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token comment"},"// 鼠标释放事件处理程序"),s(`
  `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token function-variable function"},"handleMouseUp"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"e"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"!"),s("annotationMode"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token function"},"setIsDrawing"),n("span",{class:"token punctuation"},"("),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},")"),s(`
      `),n("span",{class:"token keyword"},"return"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`

    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("isDrawing"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token function"},"setIsDrawing"),n("span",{class:"token punctuation"},"("),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},")"),s(`

      `),n("span",{class:"token comment"},"// 更新终点坐标"),s(`
      `),n("span",{class:"token keyword"},"const"),s(" canvas "),n("span",{class:"token operator"},"="),s(" canvasRef"),n("span",{class:"token punctuation"},"."),s(`current
      `),n("span",{class:"token keyword"},"const"),s(" rect "),n("span",{class:"token operator"},"="),s(" canvas"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getBoundingClientRect"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
      `),n("span",{class:"token keyword"},"const"),s(" mouseX "),n("span",{class:"token operator"},"="),s(" e"),n("span",{class:"token punctuation"},"."),s("clientX "),n("span",{class:"token operator"},"-"),s(" rect"),n("span",{class:"token punctuation"},"."),s(`left
      `),n("span",{class:"token keyword"},"const"),s(" mouseY "),n("span",{class:"token operator"},"="),s(" e"),n("span",{class:"token punctuation"},"."),s("clientY "),n("span",{class:"token operator"},"-"),s(" rect"),n("span",{class:"token punctuation"},"."),s(`top
      `),n("span",{class:"token function"},"setEndPoint"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token literal-property property"},"x"),n("span",{class:"token operator"},":"),s(" mouseX"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token literal-property property"},"y"),n("span",{class:"token operator"},":"),s(" mouseY "),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`

      `),n("span",{class:"token comment"},"// 将绘制的信息添加到 annotations 状态中"),s(`
      `),n("span",{class:"token function"},"setAnnotations"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"["),s(`
        `),n("span",{class:"token operator"},"..."),s("annotations"),n("span",{class:"token punctuation"},","),s(`
        `),n("span",{class:"token punctuation"},"{"),s(`
          `),n("span",{class:"token literal-property property"},"type"),n("span",{class:"token operator"},":"),s(" annotationMode"),n("span",{class:"token punctuation"},","),s(`
          `),n("span",{class:"token literal-property property"},"color"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token string"},"'red'"),n("span",{class:"token punctuation"},","),s(`
          `),n("span",{class:"token literal-property property"},"points"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token punctuation"},"["),s("startPoint"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token literal-property property"},"x"),n("span",{class:"token operator"},":"),s(" mouseX"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token literal-property property"},"y"),n("span",{class:"token operator"},":"),s(" mouseY "),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},"]"),s(`
          `),n("span",{class:"token comment"},"// 可以添加其他所需信息"),s(`
        `),n("span",{class:"token punctuation"},"}"),s(`
      `),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token comment"},"// 监听鼠标滚轮事件"),s(`
  `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token function-variable function"},"handleMouseWheel"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"e"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
    e`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"preventDefault"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token punctuation"},"{"),s(" deltaY "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token operator"},"="),s(` e
    `),n("span",{class:"token keyword"},"const"),s(" newScale "),n("span",{class:"token operator"},"="),s(`
      deltaY `),n("span",{class:"token operator"},">"),s(),n("span",{class:"token number"},"0"),s(`
        `),n("span",{class:"token operator"},"?"),s(),n("span",{class:"token punctuation"},"("),s("zoomFactorRef"),n("span",{class:"token punctuation"},"."),s("current "),n("span",{class:"token operator"},"*"),s(),n("span",{class:"token number"},"10"),s(),n("span",{class:"token operator"},"-"),s(),n("span",{class:"token number"},"0.1"),s(),n("span",{class:"token operator"},"*"),s(),n("span",{class:"token number"},"10"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"/"),s(),n("span",{class:"token number"},"10"),s(`
        `),n("span",{class:"token operator"},":"),s(),n("span",{class:"token punctuation"},"("),s("zoomFactorRef"),n("span",{class:"token punctuation"},"."),s("current "),n("span",{class:"token operator"},"*"),s(),n("span",{class:"token number"},"10"),s(),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token number"},"0.1"),s(),n("span",{class:"token operator"},"*"),s(),n("span",{class:"token number"},"10"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"/"),s(),n("span",{class:"token number"},"10"),s(`
    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("newScale "),n("span",{class:"token operator"},"<"),s(),n("span",{class:"token number"},"0.1"),s(),n("span",{class:"token operator"},"||"),s(" newScale "),n("span",{class:"token operator"},">"),s(),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"return"),s(`
    `),n("span",{class:"token function"},"setZoomFactor"),n("span",{class:"token punctuation"},"("),s("newScale"),n("span",{class:"token punctuation"},")"),s(`
    zoomFactorRef`),n("span",{class:"token punctuation"},"."),s("current "),n("span",{class:"token operator"},"="),s(` newScale
  `),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token comment"},"//监听缩放画布"),s(`
  `),n("span",{class:"token function"},"useEffect"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token literal-property property"},"current"),n("span",{class:"token operator"},":"),s(" canvas "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token operator"},"="),s(` canvasRef
    canvas `),n("span",{class:"token operator"},"&&"),s(`
      `),n("span",{class:"token punctuation"},"("),s("canvas"),n("span",{class:"token punctuation"},"."),s("style"),n("span",{class:"token punctuation"},"."),s("transform "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token template-string"},[n("span",{class:"token template-punctuation string"},"`"),n("span",{class:"token string"},"scale("),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("zoomFactorRef"),n("span",{class:"token punctuation"},"."),s("current"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token string"},","),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("zoomFactorRef"),n("span",{class:"token punctuation"},"."),s("current"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token string"},")"),n("span",{class:"token template-punctuation string"},"`")]),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"["),s("zoomFactorRef"),n("span",{class:"token punctuation"},"."),s("current"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),s(`

  `),n("span",{class:"token function"},"useEffect"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token literal-property property"},"current"),n("span",{class:"token operator"},":"),s(" canvas "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token operator"},"="),s(` canvasRef
    `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token literal-property property"},"current"),n("span",{class:"token operator"},":"),s(" wrap "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token operator"},"="),s(` wrapRef
    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"!"),s("canvasRef"),n("span",{class:"token punctuation"},"."),s("current"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"return"),s(`
    canvas`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"addEventListener"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'mousedown'"),n("span",{class:"token punctuation"},","),s(" handleMouseDown"),n("span",{class:"token punctuation"},")"),s(`
    canvas`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"addEventListener"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'mousemove'"),n("span",{class:"token punctuation"},","),s(" handleMouseMove"),n("span",{class:"token punctuation"},")"),s(`
    canvas`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"addEventListener"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'mouseup'"),n("span",{class:"token punctuation"},","),s(" handleMouseUp"),n("span",{class:"token punctuation"},")"),s(`
    wrap`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"addEventListener"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'wheel'"),n("span",{class:"token punctuation"},","),s(" handleMouseWheel"),n("span",{class:"token punctuation"},")"),s(`

    `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
      canvas`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"removeEventListener"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'mousedown'"),n("span",{class:"token punctuation"},","),s(" handleMouseDown"),n("span",{class:"token punctuation"},")"),s(`
      canvas`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"removeEventListener"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'mousemove'"),n("span",{class:"token punctuation"},","),s(" handleMouseMove"),n("span",{class:"token punctuation"},")"),s(`
      canvas`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"removeEventListener"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'mouseup'"),n("span",{class:"token punctuation"},","),s(" handleMouseUp"),n("span",{class:"token punctuation"},")"),s(`
      wrap`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"removeEventListener"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'wheel'"),n("span",{class:"token punctuation"},","),s(" handleMouseWheel"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"["),s("annotations"),n("span",{class:"token punctuation"},","),s(" annotationMode"),n("span",{class:"token punctuation"},","),s(" isDrawing"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),s(`

  `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token function-variable function"},"handleAnnotationModeChange"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"e"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
    console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),s("e"),n("span",{class:"token punctuation"},"."),s("target"),n("span",{class:"token punctuation"},"."),s("value "),n("span",{class:"token operator"},"?"),s(" e"),n("span",{class:"token punctuation"},"."),s("target"),n("span",{class:"token punctuation"},"."),s("value "),n("span",{class:"token operator"},":"),s(),n("span",{class:"token keyword"},"undefined"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},"'批注模式'"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token function"},"setAnnotationMode"),n("span",{class:"token punctuation"},"("),s("e"),n("span",{class:"token punctuation"},"."),s("target"),n("span",{class:"token punctuation"},"."),s("value "),n("span",{class:"token operator"},"?"),s(" e"),n("span",{class:"token punctuation"},"."),s("target"),n("span",{class:"token punctuation"},"."),s("value "),n("span",{class:"token operator"},":"),s(),n("span",{class:"token keyword"},"undefined"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token punctuation"},"("),s(`
    `),n("span",{class:"token operator"},"<"),n("span",{class:"token operator"},">"),s(`
      `),n("span",{class:"token operator"},"<"),s(`div
        ref`),n("span",{class:"token operator"},"="),n("span",{class:"token punctuation"},"{"),s("wrapRef"),n("span",{class:"token punctuation"},"}"),s(`
        style`),n("span",{class:"token operator"},"="),n("span",{class:"token punctuation"},"{"),n("span",{class:"token punctuation"},"{"),s(`
          `),n("span",{class:"token literal-property property"},"display"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token string"},"'flex'"),n("span",{class:"token punctuation"},","),s(`
          `),n("span",{class:"token literal-property property"},"justifyContent"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token string"},"'center'"),n("span",{class:"token punctuation"},","),s(`
          `),n("span",{class:"token literal-property property"},"alignItems"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token string"},"'center'"),n("span",{class:"token punctuation"},","),s(`
          `),n("span",{class:"token literal-property property"},"height"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token string"},"'300px'"),n("span",{class:"token punctuation"},","),s(`
          `),n("span",{class:"token literal-property property"},"width"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token string"},"'500px'"),n("span",{class:"token punctuation"},","),s(`
          `),n("span",{class:"token literal-property property"},"backgroundColor"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token string"},"'#edeef0'"),s(`
        `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},"}"),s(`
      `),n("span",{class:"token operator"},">"),s(`
        `),n("span",{class:"token operator"},"<"),s("canvas ref"),n("span",{class:"token operator"},"="),n("span",{class:"token punctuation"},"{"),s("canvasRef"),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token operator"},"/"),n("span",{class:"token operator"},">"),s(`
      `),n("span",{class:"token operator"},"<"),n("span",{class:"token operator"},"/"),s("div"),n("span",{class:"token operator"},">"),s(`
      `),n("span",{class:"token operator"},"<"),s("fieldset style"),n("span",{class:"token operator"},"="),n("span",{class:"token punctuation"},"{"),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token literal-property property"},"boxSizing"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token string"},"'border-box'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token literal-property property"},"width"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"500"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token literal-property property"},"marginTop"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"10"),s(),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token operator"},">"),s(`
        `),n("span",{class:"token operator"},"<"),s("legend"),n("span",{class:"token operator"},">"),s("图片批注"),n("span",{class:"token operator"},"<"),n("span",{class:"token operator"},"/"),s("legend"),n("span",{class:"token operator"},">"),s(`

        `),n("span",{class:"token operator"},"<"),s("div style"),n("span",{class:"token operator"},"="),n("span",{class:"token punctuation"},"{"),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token literal-property property"},"marginBottom"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"10"),s(),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token operator"},">"),s(`
          `),n("span",{class:"token operator"},"<"),s(`input
            type`),n("span",{class:"token operator"},"="),n("span",{class:"token string"},'"radio"'),s(`
            id`),n("span",{class:"token operator"},"="),n("span",{class:"token string"},'"none"'),s(`
            name`),n("span",{class:"token operator"},"="),n("span",{class:"token string"},'"type"'),s(`
            value`),n("span",{class:"token operator"},"="),n("span",{class:"token punctuation"},"{"),n("span",{class:"token keyword"},"undefined"),n("span",{class:"token punctuation"},"}"),s(`
            checked`),n("span",{class:"token operator"},"="),n("span",{class:"token punctuation"},"{"),s("annotationMode "),n("span",{class:"token operator"},"==="),s(),n("span",{class:"token keyword"},"undefined"),n("span",{class:"token punctuation"},"}"),s(`
            onChange`),n("span",{class:"token operator"},"="),n("span",{class:"token punctuation"},"{"),s("handleAnnotationModeChange"),n("span",{class:"token punctuation"},"}"),s(`
          `),n("span",{class:"token operator"},"/"),n("span",{class:"token operator"},">"),s(`
          `),n("span",{class:"token operator"},"<"),s("label htmlFor"),n("span",{class:"token operator"},"="),n("span",{class:"token string"},'"none"'),n("span",{class:"token operator"},">"),s("无"),n("span",{class:"token operator"},"<"),n("span",{class:"token operator"},"/"),s("label"),n("span",{class:"token operator"},">"),s(`

          `),n("span",{class:"token operator"},"<"),s(`input
            type`),n("span",{class:"token operator"},"="),n("span",{class:"token string"},'"radio"'),s(`
            id`),n("span",{class:"token operator"},"="),n("span",{class:"token string"},'"line"'),s(`
            name`),n("span",{class:"token operator"},"="),n("span",{class:"token string"},'"type"'),s(`
            value`),n("span",{class:"token operator"},"="),n("span",{class:"token string"},'"line"'),s(`
            checked`),n("span",{class:"token operator"},"="),n("span",{class:"token punctuation"},"{"),s("annotationMode "),n("span",{class:"token operator"},"==="),s(),n("span",{class:"token string"},"'line'"),n("span",{class:"token punctuation"},"}"),s(`
            onChange`),n("span",{class:"token operator"},"="),n("span",{class:"token punctuation"},"{"),s("handleAnnotationModeChange"),n("span",{class:"token punctuation"},"}"),s(`
          `),n("span",{class:"token operator"},"/"),n("span",{class:"token operator"},">"),s(`
          `),n("span",{class:"token operator"},"<"),s("label htmlFor"),n("span",{class:"token operator"},"="),n("span",{class:"token string"},'"line"'),n("span",{class:"token operator"},">"),s("线"),n("span",{class:"token operator"},"<"),n("span",{class:"token operator"},"/"),s("label"),n("span",{class:"token operator"},">"),s(`

          `),n("span",{class:"token operator"},"<"),s(`input
            type`),n("span",{class:"token operator"},"="),n("span",{class:"token string"},'"radio"'),s(`
            id`),n("span",{class:"token operator"},"="),n("span",{class:"token string"},'"rectangle"'),s(`
            name`),n("span",{class:"token operator"},"="),n("span",{class:"token string"},'"type"'),s(`
            value`),n("span",{class:"token operator"},"="),n("span",{class:"token string"},'"rectangle"'),s(`
            checked`),n("span",{class:"token operator"},"="),n("span",{class:"token punctuation"},"{"),s("annotationMode "),n("span",{class:"token operator"},"==="),s(),n("span",{class:"token string"},"'rectangle'"),n("span",{class:"token punctuation"},"}"),s(`
            onChange`),n("span",{class:"token operator"},"="),n("span",{class:"token punctuation"},"{"),s("handleAnnotationModeChange"),n("span",{class:"token punctuation"},"}"),s(`
          `),n("span",{class:"token operator"},"/"),n("span",{class:"token operator"},">"),s(`
          `),n("span",{class:"token operator"},"<"),s("label htmlFor"),n("span",{class:"token operator"},"="),n("span",{class:"token string"},'"rectangle"'),n("span",{class:"token operator"},">"),s("框"),n("span",{class:"token operator"},"<"),n("span",{class:"token operator"},"/"),s("label"),n("span",{class:"token operator"},">"),s(`
        `),n("span",{class:"token operator"},"<"),n("span",{class:"token operator"},"/"),s("div"),n("span",{class:"token operator"},">"),s(`

        `),n("span",{class:"token operator"},"<"),s("input type"),n("span",{class:"token operator"},"="),n("span",{class:"token string"},'"file"'),s(" accept"),n("span",{class:"token operator"},"="),n("span",{class:"token string"},'"image/*"'),s(" onChange"),n("span",{class:"token operator"},"="),n("span",{class:"token punctuation"},"{"),s("handleImageChange"),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token operator"},"/"),n("span",{class:"token operator"},">"),s(`
      `),n("span",{class:"token operator"},"<"),n("span",{class:"token operator"},"/"),s("fieldset"),n("span",{class:"token operator"},">"),s(`
    `),n("span",{class:"token operator"},"<"),n("span",{class:"token operator"},"/"),n("span",{class:"token operator"},">"),s(`
  `),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1)])),_:1,__:[3]})])}const f=c(k,[["render",m],["__file","002-annotation.html.vue"]]),g=JSON.parse('{"path":"/frontend/practice/002-annotation.html","title":"图片批注","lang":"zh-CN","frontmatter":{"title":"图片批注","date":"2023-12-28T00:00:00.000Z","icon":"edit","category":["practice"],"tag":["frontend","图片批注"],"description":" 相关信息 demo: https://codesandbox.io/p/sandbox/image-annotation-pht676?file=%2Fsrc%2FApp.js%3A210%2C56 实现图片批注有两种方案，一种是通过 SVG 绘制，一种是通过 Canvas 绘制。以下是两者对比： 综上，选择使用 Canvas 实现图片批注。 加载图...","head":[["meta",{"property":"og:url","content":"https://dribble-njr.github.io/blog/blog/frontend/practice/002-annotation.html"}],["meta",{"property":"og:title","content":"图片批注"}],["meta",{"property":"og:description","content":" 相关信息 demo: https://codesandbox.io/p/sandbox/image-annotation-pht676?file=%2Fsrc%2FApp.js%3A210%2C56 实现图片批注有两种方案，一种是通过 SVG 绘制，一种是通过 Canvas 绘制。以下是两者对比： 综上，选择使用 Canvas 实现图片批注。 加载图..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-11-06T15:43:46.000Z"}],["meta",{"property":"article:author","content":"njr"}],["meta",{"property":"article:tag","content":"frontend"}],["meta",{"property":"article:tag","content":"图片批注"}],["meta",{"property":"article:published_time","content":"2023-12-28T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-11-06T15:43:46.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"图片批注\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2023-12-28T00:00:00.000Z\\",\\"dateModified\\":\\"2024-11-06T15:43:46.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"njr\\",\\"url\\":\\"https://github.com/dribble-njr/blog\\",\\"email\\":\\"wzw15292257101@163.com\\"}]}"]]},"headers":[{"level":2,"title":"1 加载图片","slug":"加载图片","link":"#加载图片","children":[]},{"level":2,"title":"2 绘制批注","slug":"绘制批注","link":"#绘制批注","children":[]},{"level":2,"title":"3 记录起点终点","slug":"记录起点终点","link":"#记录起点终点","children":[]},{"level":2,"title":"4 图片缩放","slug":"图片缩放","link":"#图片缩放","children":[]},{"level":2,"title":"5 最终代码","slug":"最终代码","link":"#最终代码","children":[]}],"git":{"createdTime":1704622731000,"updatedTime":1730907826000,"contributors":[{"name":"dribble-njr","email":"wzw15292257101@163.com","commits":3}]},"readingTime":{"minutes":7.09,"words":2127},"filePathRelative":"frontend/practice/002-annotation.md","localizedDate":"2023年12月28日","excerpt":"","autoDesc":true}');export{f as comp,g as data};
