import{_ as o,c as e,a as s,b as t,e as p,r as c,o as l}from"./app-nKKmHBUX.js";const i={};function u(k,n){const a=c("Mermaid");return l(),e("div",null,[n[0]||(n[0]=s("h2",{id:"video-js-component-基础概念",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#video-js-component-基础概念"},[s("span",null,[s("strong",null,"Video.js Component 基础概念")])])],-1)),n[1]||(n[1]=s("h3",{id:"什么是-video-js-component",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#什么是-video-js-component"},[s("span",null,"什么是 Video.js Component？")])],-1)),n[2]||(n[2]=s("p",null,"Video.js Component 是基于 Video.js Player 框架的可扩展 UI 元素，用于增强视频播放器的功能和用户体验。每个 Component 都是独立的、可重用的模块。",-1)),t(a,{id:"mermaid-9",code:"eJx1z0sOgjAQBuC9p+gF9AgmAqL4iCQimwkLIhPEtB3Sh4bbCy0SXNhlv3n8U6uyfbAsWrD+bSBvKqTVU7OUlx2qgi2XaxZASKIlidKwa6cNisKVB05DuCVsKtBzivpGaRTxP76F0GpD4oedh85jGGIE1hiSvs//7yBVVCvUOijVHPaQE7cCx7XjsMhZAlkjMGp028/0TR4OEFvO9V0hyu8ux1vHx/4IK01FbznF9O3eT1OYywvVNNvjebxwDDSc9wGWYG5k"}),n[3]||(n[3]=s("h3",{id:"component-继承关系",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#component-继承关系"},[s("span",null,"Component 继承关系")])],-1)),t(a,{id:"mermaid-13",code:"eJyFUEsOgjAQ3XOKLiHCBYwrgcTEz8oLVDpoY9shbcEQ9e4CGoumgVm+X99rIagxGadnTWVAuhsAkqKsUIGy5D6g/S1AhBFZks1xv8sFyI51HGUs7Z3h4D9QCb20Qc6cRoPEBmZlqEJouvCYXKhiArRHUpazGsZNhQaGyl/mGYxGrmtrUY0XvsNSwYvrr2/EbqHN8KYmctPaWJTeLyxQGavrwqIOK0Fb0DHByvIOjpzqxBXL+3nG02Jql3tz9UiSz0Af81cxCF5LypWM"}),n[4]||(n[4]=p(`<h3 id="核心-api" tabindex="-1"><a class="header-anchor" href="#核心-api"><span>核心 API</span></a></h3><div class="language-tsx line-numbers-mode" data-ext="tsx" data-title="tsx"><pre class="language-tsx"><code><span class="token comment">// 基础 Component 类</span>
<span class="token keyword">class</span> <span class="token class-name">MyComponent</span> <span class="token keyword">extends</span> <span class="token class-name">videojs</span><span class="token punctuation">.</span><span class="token function">getComponent</span><span class="token punctuation">(</span><span class="token string">&#39;Component&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>player<span class="token operator">:</span> Player<span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>player<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 初始化逻辑</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 获取 DOM 元素</span>
  <span class="token function">el</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> HTMLElement

  <span class="token comment">// 添加/移除 CSS 类</span>
  <span class="token function">addClass</span><span class="token punctuation">(</span>className<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
  <span class="token function">removeClass</span><span class="token punctuation">(</span>className<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>

  <span class="token comment">// 事件绑定</span>
  <span class="token function">on</span><span class="token punctuation">(</span>event<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> handler<span class="token operator">:</span> <span class="token builtin">Function</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
  <span class="token function">off</span><span class="token punctuation">(</span>event<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> handler<span class="token operator">:</span> <span class="token builtin">Function</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>

  <span class="token comment">// 清理资源</span>
  <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="component-设计理念" tabindex="-1"><a class="header-anchor" href="#component-设计理念"><span>Component 设计理念</span></a></h2><h3 id="_1-单一职责原则" tabindex="-1"><a class="header-anchor" href="#_1-单一职责原则"><span>1. 单一职责原则</span></a></h3><p>每个 Component 只负责一个特定功能，如：</p><ul><li><strong>Countdown Component</strong>：只负责显示剩余时间</li><li><strong>Progress Bar Component</strong>：只负责显示播放进度</li><li><strong>Progress Overlay Component</strong>：只负责处理拖动交互</li></ul><h3 id="_2-component-通信模式" tabindex="-1"><a class="header-anchor" href="#_2-component-通信模式"><span>2. Component 通信模式</span></a></h3>`,8)),t(a,{id:"mermaid-48",code:"eJxLL0osyFDwCeJSAALH6ICcxMrUolgFXV07Bado5/zcgvy81LwSBcdYiAKwhDOShBNEwklBV0/Xrsa1DChWo+AIFnPGIgY0ACQWXJJYkqoQWpACpGoUnHBLOXNxAQBOryyo"}),n[5]||(n[5]=s("h3",{id:"_3-事件驱动架构",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#_3-事件驱动架构"},[s("span",null,"3. 事件驱动架构")])],-1)),t(a,{id:"mermaid-52",code:"eJwrTi0sTc1LTnXJTEwvSszlUgCCgsSikszkzILEvBKFAIXEYoWAnMTK1CIMOWeQnHN+bkF+XmpeCYa0i78vSAGIcs1JzQUpAasJ0LWzc7ZSeNox++nuXWj6nYFyQA1wWZDmp63Nz7csgEsHWCk8nz3x6YQ1UGcpPNnV/WT3NmSjXyxf9rR/IkRcQaMkMze1tCAlsSRVE9WOZ7O3PJu2QSHUE9lsiN4X7auerpv1ZGcn1HAuANGTcV0="}),n[6]||(n[6]=s("hr",null,null,-1)),n[7]||(n[7]=s("h2",{id:"component-生命周期",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#component-生命周期"},[s("span",null,"Component 生命周期")])],-1)),t(a,{id:"mermaid-57",code:"eJxLL0osyFAIceFSAALHaOf83IL8vNS8EoWnHbOf7t4Vq6Cra6fgBBTPKy4pKk0uyS9SeNa5/MXCnliwDiewvHO0i7+vwtPW5udbFkD1gWWdwbIu0a5lIBOf7574dN0siIwLWMYVyb5n+xuebdkNkXUFy7pB9T1d0vJ8QhtExg0s416N0PdySsOz9Y32tWBpd5B0zdMJy2oU3JAEns1YX6PgATXuxfLFQJdAjPMAG+cJdv6zHa1wazzB4l7RL7a2PNs14WV717Mp+2K5uAB/O2/F"}),n[8]||(n[8]=p(`<h3 id="生命周期详解" tabindex="-1"><a class="header-anchor" href="#生命周期详解"><span>生命周期详解</span></a></h3><ol><li><strong>创建阶段</strong><ul><li>Constructor 调用</li><li>DOM 元素创建</li><li>CSS 类添加</li></ul></li><li><strong>激活阶段</strong><ul><li>Event Listener 绑定</li><li>Player 事件订阅</li><li>Component 功能启用</li></ul></li><li><strong>运行阶段</strong><ul><li>Event 处理</li><li>UI 更新</li><li>State 同步</li></ul></li><li><strong>销毁阶段</strong><ul><li>Event 解绑</li><li>DOM 元素移除</li><li>内存清理</li></ul></li></ol><hr><h2 id="实战案例-countdown-component" tabindex="-1"><a class="header-anchor" href="#实战案例-countdown-component"><span>实战案例：Countdown Component</span></a></h2><h3 id="功能需求" tabindex="-1"><a class="header-anchor" href="#功能需求"><span>功能需求</span></a></h3><p>显示视频剩余播放时间，实时更新倒计时显示。</p><h3 id="实现代码" tabindex="-1"><a class="header-anchor" href="#实现代码"><span>实现代码</span></a></h3><div class="language-tsx line-numbers-mode" data-ext="tsx" data-title="tsx"><pre class="language-tsx"><code><span class="token keyword">import</span> videojs <span class="token keyword">from</span> <span class="token string">&#39;video.js&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token class-name">Player</span> <span class="token keyword">from</span> <span class="token string">&#39;video.js/dist/types/player&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> formatTime <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/pages/oral-class-report/utils/time&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">CountdownComponent</span> <span class="token keyword">extends</span> <span class="token class-name">videojs</span><span class="token punctuation">.</span><span class="token function">getComponent</span><span class="token punctuation">(</span><span class="token string">&#39;Component&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token keyword">readonly</span> countdownElement<span class="token operator">:</span> HTMLElement<span class="token punctuation">;</span>
  <span class="token keyword">private</span> countdown<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span>player<span class="token operator">:</span> Player<span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>player<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>countdown <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>countdownElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;div&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>countdownElement<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">&#39;vjs-countdown&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>countdownElement<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token function">formatTime</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>countdown<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addClass</span><span class="token punctuation">(</span><span class="token string">&#39;vjs-countdown-component&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">el</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>countdownElement<span class="token punctuation">)</span><span class="token punctuation">;</span>

    player<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;loadedmetadata&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleLoadedMetadata<span class="token punctuation">)</span><span class="token punctuation">;</span>
    player<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;timeupdate&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleTimeUpdate<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token function-variable function">handleLoadedMetadata</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>countdown <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">player</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">duration</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateCountdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token function-variable function">handleTimeUpdate</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> currentTime <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">player</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">currentTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> duration <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">player</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">duration</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>countdown <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> duration <span class="token operator">-</span> currentTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateCountdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token function-variable function">updateCountdown</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>countdownElement<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token function">formatTime</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>countdown<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">player</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">&#39;loadedmetadata&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleLoadedMetadata<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">player</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">&#39;timeupdate&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleTimeUpdate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

videojs<span class="token punctuation">.</span><span class="token function">registerComponent</span><span class="token punctuation">(</span><span class="token string">&#39;CountdownComponent&#39;</span><span class="token punctuation">,</span> CountdownComponent<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> CountdownComponent<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="技术要点" tabindex="-1"><a class="header-anchor" href="#技术要点"><span>技术要点</span></a></h3><ol><li><strong>Event 监听</strong>：监听 <code>loadedmetadata</code> 和 <code>timeupdate</code> 事件</li><li><strong>DOM 操作</strong>：动态创建和更新倒计时显示元素</li><li><strong>State 管理</strong>：维护倒计时数值状态</li><li><strong>资源清理</strong>：在 <code>dispose()</code> 中解绑事件</li></ol><hr><h2 id="实战案例-progress-bar-component" tabindex="-1"><a class="header-anchor" href="#实战案例-progress-bar-component"><span>实战案例：Progress Bar Component</span></a></h2><h3 id="功能需求-1" tabindex="-1"><a class="header-anchor" href="#功能需求-1"><span>功能需求</span></a></h3><p>显示视频播放进度，支持平滑更新，在拖动时暂停自动更新。</p><h3 id="实现代码-1" tabindex="-1"><a class="header-anchor" href="#实现代码-1"><span>实现代码</span></a></h3><div class="language-tsx line-numbers-mode" data-ext="tsx" data-title="tsx"><pre class="language-tsx"><code><span class="token keyword">import</span> videojs <span class="token keyword">from</span> <span class="token string">&#39;video.js&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token class-name">Player</span> <span class="token keyword">from</span> <span class="token string">&#39;video.js/dist/types/player&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">UPDATE_REFRESH_INTERVAL</span> <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ProgressBar</span> <span class="token keyword">extends</span> <span class="token class-name">videojs</span><span class="token punctuation">.</span><span class="token function">getComponent</span><span class="token punctuation">(</span><span class="token string">&#39;Component&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token keyword">readonly</span> progressBar<span class="token operator">:</span> HTMLDivElement<span class="token punctuation">;</span>
  <span class="token keyword">private</span> updateInterval<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> isDragging <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span>player<span class="token operator">:</span> Player<span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>player<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>progressBar <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;div&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>progressBar<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">&#39;vjs-progress-bar&#39;</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addClass</span><span class="token punctuation">(</span><span class="token string">&#39;vjs-progress-bar-container&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">el</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>progressBar<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">bindEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">//#region 事件绑定</span>
  <span class="token keyword">private</span> <span class="token function">bindEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">player</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;timeupdate&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleTimeUpdate<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 平滑进度条</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">player</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;playing&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>enableInterval<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">player</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;ended&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;pause&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;waiting&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>disableInterval<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 监听页面可见性变化</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&#39;hidden&#39;</span> <span class="token keyword">in</span> document <span class="token operator">&amp;&amp;</span> <span class="token string">&#39;visibilityState&#39;</span> <span class="token keyword">in</span> document<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>
        <span class="token string">&#39;visibilitychange&#39;</span><span class="token punctuation">,</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>handleVisibilityChange
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//#endregion</span>

  <span class="token comment">//#region 进度条平滑更新</span>
  <span class="token keyword">private</span> <span class="token keyword">readonly</span> handleTimeUpdate <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>isDragging<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> currentTime <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">player</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">currentTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> duration <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">player</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">duration</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>duration <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> percent <span class="token operator">=</span> <span class="token punctuation">(</span>currentTime <span class="token operator">/</span> duration<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateProgress</span><span class="token punctuation">(</span>percent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  updateProgress <span class="token operator">=</span> <span class="token punctuation">(</span>percent<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>progressBar<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>percent<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">%</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// 设置拖动状态，暂停自动更新</span>
  setDragging <span class="token operator">=</span> <span class="token punctuation">(</span>dragging<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>isDragging <span class="token operator">=</span> dragging<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>dragging<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">disableInterval</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">player</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ended</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">player</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">paused</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">enableInterval</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">private</span> <span class="token keyword">readonly</span> handleVisibilityChange <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>visibilityState <span class="token operator">===</span> <span class="token string">&#39;hidden&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">disableInterval</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>
        <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">player</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ended</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
        <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">player</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">paused</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
        <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isDragging
      <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">enableInterval</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleTimeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">private</span> <span class="token keyword">readonly</span> enableInterval <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>updateInterval <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>isDragging<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>updateInterval <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setInterval</span><span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>handleTimeUpdate<span class="token punctuation">,</span>
      <span class="token constant">UPDATE_REFRESH_INTERVAL</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">private</span> <span class="token keyword">readonly</span> disableInterval <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>updateInterval<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>updateInterval<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>updateInterval <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment">//#endregion</span>

  <span class="token comment">//#region 清理函数</span>
  <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">player</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">&#39;timeupdate&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleTimeUpdate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">player</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">&#39;playing&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>enableInterval<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">player</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;ended&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;pause&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;waiting&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>disableInterval<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&#39;hidden&#39;</span> <span class="token keyword">in</span> document <span class="token operator">&amp;&amp;</span> <span class="token string">&#39;visibilityState&#39;</span> <span class="token keyword">in</span> document<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      document<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span>
        <span class="token string">&#39;visibilitychange&#39;</span><span class="token punctuation">,</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>handleVisibilityChange
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">disableInterval</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//#endregion</span>
<span class="token punctuation">}</span>

videojs<span class="token punctuation">.</span><span class="token function">registerComponent</span><span class="token punctuation">(</span><span class="token string">&#39;ProgressBar&#39;</span><span class="token punctuation">,</span> ProgressBar<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> ProgressBar<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="技术要点-1" tabindex="-1"><a class="header-anchor" href="#技术要点-1"><span>技术要点</span></a></h3><ol><li><strong>平滑更新</strong>：使用 <code>setInterval</code> 实现 30ms 间隔的平滑更新</li><li><strong>拖动状态管理</strong>：通过 <code>isDragging</code> 状态控制是否自动更新</li><li><strong>性能优化</strong>：在页面不可见时暂停更新</li><li><strong>外部控制</strong>：提供 <code>setDragging()</code> 方法供外部 Component 调用</li></ol><hr><h2 id="实战案例-progress-overlay-component" tabindex="-1"><a class="header-anchor" href="#实战案例-progress-overlay-component"><span>实战案例：Progress Overlay Component</span></a></h2><h3 id="功能需求-2" tabindex="-1"><a class="header-anchor" href="#功能需求-2"><span>功能需求</span></a></h3><p>实现拖动进度条功能，拖动过程中继续播放，只更新进度条显示，拖动结束时才真正 seek。</p><h3 id="实现代码-2" tabindex="-1"><a class="header-anchor" href="#实现代码-2"><span>实现代码</span></a></h3><div class="language-tsx line-numbers-mode" data-ext="tsx" data-title="tsx"><pre class="language-tsx"><code><span class="token keyword">import</span> videojs <span class="token keyword">from</span> <span class="token string">&#39;video.js&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token class-name">Player</span> <span class="token keyword">from</span> <span class="token string">&#39;video.js/dist/types/player&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ProgressBar <span class="token keyword">from</span> <span class="token string">&#39;./ProgressBar&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">UPDATE_REFRESH_INTERVAL</span> <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ProgressOverlay</span> <span class="token keyword">extends</span> <span class="token class-name">videojs</span><span class="token punctuation">.</span><span class="token function">getComponent</span><span class="token punctuation">(</span><span class="token string">&#39;Component&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token keyword">readonly</span> playIcon<span class="token operator">:</span> HTMLImageElement<span class="token punctuation">;</span>
  <span class="token keyword">private</span> isDragging <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> isPlaying <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> startX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> totalWidth <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> totalDuration <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> updateInterval<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> dragStartTime <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span>player<span class="token operator">:</span> Player<span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	  <span class="token comment">// 合并 options，让 videojs 能正确注册组件</span>
    options <span class="token operator">=</span> videojs<span class="token punctuation">.</span>obj<span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>ProgressOverlay<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>options_<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">super</span><span class="token punctuation">(</span>player<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emitTapEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    player<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;loadedmetadata&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>totalDuration <span class="token operator">=</span> player<span class="token punctuation">.</span><span class="token function">duration</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>playIcon <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>playIcon<span class="token punctuation">.</span>src <span class="token operator">=</span> options<span class="token punctuation">.</span>playIcon<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>playIcon<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">&#39;vjs-play-icon&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">el</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>playIcon<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addClass</span><span class="token punctuation">(</span><span class="token string">&#39;vjs-progress-overlay&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">bindEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">//#region 事件绑定</span>
  <span class="token keyword">private</span> <span class="token function">bindEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;tap&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleTogglePlay<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">player</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;play&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handlePlay<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">player</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;pause&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handlePause<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 触摸事件支持</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;touchstart&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleTouchStart <span class="token keyword">as</span> EventListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;touchmove&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleTouchMove <span class="token keyword">as</span> EventListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;touchend&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleTouchEnd <span class="token keyword">as</span> EventListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//#endregion</span>

  <span class="token comment">//#region 播放相关</span>
  <span class="token keyword">private</span> <span class="token keyword">readonly</span> handleTogglePlay <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;tap&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>isDragging <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">player</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">&#39;togglePlay&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">private</span> <span class="token keyword">readonly</span> handlePlay <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>playIcon<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">&#39;none&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">el</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&#39;style&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;touch-action: none;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>isPlaying <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">private</span> <span class="token keyword">readonly</span> handlePause <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>playIcon<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">&#39;block&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">el</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&#39;style&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;touch-action: auto;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>isPlaying <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment">//#endregion</span>

  <span class="token comment">//#region 拖动进度</span>
  <span class="token keyword">private</span> <span class="token keyword">readonly</span> handleTouchStart <span class="token operator">=</span> <span class="token punctuation">(</span>event<span class="token operator">:</span> TouchEvent<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isPlaying<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;handleTouchStart&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>isDragging <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>totalWidth <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">currentWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>startX <span class="token operator">=</span> event<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientX<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dragStartTime <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">player</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">currentTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getChild</span><span class="token punctuation">(</span><span class="token string">&#39;ProgressBar&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> ProgressBar<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setDragging</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">private</span> <span class="token keyword">readonly</span> handleTouchMove <span class="token operator">=</span> <span class="token punctuation">(</span>event<span class="token operator">:</span> TouchEvent<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isDragging<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> percent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">calculatePercent</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;touchmove percent&#39;</span><span class="token punctuation">,</span> percent<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 只更新进度条，不真正 seek</span>
    <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getChild</span><span class="token punctuation">(</span><span class="token string">&#39;ProgressBar&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> ProgressBar<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">updateProgress</span><span class="token punctuation">(</span>percent<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">private</span> <span class="token keyword">readonly</span> handleTouchEnd <span class="token operator">=</span> <span class="token punctuation">(</span>event<span class="token operator">:</span> TouchEvent<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isDragging<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> percent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">calculatePercent</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>changedTouches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>isDragging <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;handleTouchEnd&#39;</span><span class="token punctuation">,</span> percent<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 拖动结束时才真正 seek</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">seekToPercent</span><span class="token punctuation">(</span>percent<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getChild</span><span class="token punctuation">(</span><span class="token string">&#39;ProgressBar&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> ProgressBar<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setDragging</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">private</span> <span class="token function">calculatePercent</span><span class="token punctuation">(</span>touch<span class="token operator">:</span> Touch<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isDragging<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> currentX <span class="token operator">=</span> touch<span class="token punctuation">.</span>clientX<span class="token punctuation">;</span>
    <span class="token keyword">const</span> dx <span class="token operator">=</span> currentX <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>startX<span class="token punctuation">;</span>
    <span class="token keyword">const</span> deltaX <span class="token operator">=</span> dx <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>totalWidth<span class="token punctuation">;</span>
    <span class="token comment">// 使用拖动开始时的播放时间作为基准</span>
    <span class="token keyword">const</span> currentSeconds <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dragStartTime<span class="token punctuation">;</span>

    <span class="token keyword">const</span> newTime <span class="token operator">=</span> currentSeconds <span class="token operator">+</span> deltaX <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>totalDuration<span class="token punctuation">;</span>
    <span class="token comment">// 确保时间在有效范围内</span>
    <span class="token keyword">const</span> clampedTime <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>newTime<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>totalDuration<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>clampedTime <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>totalDuration<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">private</span> <span class="token keyword">readonly</span> seekToPercent <span class="token operator">=</span> <span class="token punctuation">(</span>percent<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>totalDuration <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> time <span class="token operator">=</span> <span class="token punctuation">(</span>percent <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>totalDuration<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">player</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">currentTime</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment">//#endregion</span>

  <span class="token comment">//#region 清理函数</span>
  <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">&#39;tap&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleTogglePlay<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">&#39;touchstart&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleTouchStart <span class="token keyword">as</span> EventListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">&#39;touchmove&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleTouchMove <span class="token keyword">as</span> EventListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">&#39;touchend&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleTouchEnd <span class="token keyword">as</span> EventListener<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>updateInterval<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>updateInterval<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>updateInterval <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//#endregion</span>
<span class="token punctuation">}</span>

ProgressOverlay<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>options_ <span class="token operator">=</span> <span class="token punctuation">{</span>
  children<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;ProgressBar&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  playIcon<span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

videojs<span class="token punctuation">.</span><span class="token function">registerComponent</span><span class="token punctuation">(</span><span class="token string">&#39;ProgressOverlay&#39;</span><span class="token punctuation">,</span> ProgressOverlay<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> ProgressOverlay<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="技术要点-2" tabindex="-1"><a class="header-anchor" href="#技术要点-2"><span>技术要点</span></a></h3><ol><li><strong>拖动状态管理</strong>：记录拖动开始位置和时间</li><li><strong>进度计算</strong>：基于拖动距离计算目标进度</li><li><strong>边界保护</strong>：确保进度值在有效范围内</li><li><strong>Component 协作： <code>merge</code></strong> 与 Progress Bar Component 配合实现平滑体验</li></ol><h2 id="使用" tabindex="-1"><a class="header-anchor" href="#使用"><span>使用</span></a></h2><div class="language-tsx line-numbers-mode" data-ext="tsx" data-title="tsx"><pre class="language-tsx"><code><span class="token keyword">import</span> Countdown <span class="token keyword">from</span> <span class="token string">&#39;./components/Countdown&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ProgressOverlay <span class="token keyword">from</span> <span class="token string">&#39;./components/ProgressOverlay&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&#39;./components/ProgressBar&#39;</span><span class="token punctuation">;</span> <span class="token comment">// 必须导入，videojs 才能正确注册组件</span>

<span class="token keyword">const</span> player <span class="token operator">=</span> <span class="token punctuation">(</span>playerRef<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token function">videojs</span><span class="token punctuation">(</span>videoElement<span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  player<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Countdown</span><span class="token punctuation">(</span>player<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  player<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token class-name">ProgressOverlay</span><span class="token punctuation">(</span>player<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      playIcon<span class="token operator">:</span> playBtn<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h2><ol><li><strong>基础概念</strong>：Component 继承体系、生命周期、Event 系统</li><li><strong>设计原则</strong>：单一职责、事件驱动、组件通信</li><li><strong>技术要点</strong>：DOM 操作、Event 管理、State 同步、性能优化</li><li><strong>实战经验</strong>：移动端适配、错误处理、资源清理</li></ol><p>通过合理运用这些技术，可以开发出功能强大、性能优异的自定义 Video.js Component。</p>`,32))])}const d=o(i,[["render",u],["__file","022-videojs-component.html.vue"]]),v=JSON.parse('{"path":"/frontend/practice/022-videojs-component.html","title":"Video.js Component 开发指南","lang":"zh-CN","frontmatter":{"title":"Video.js Component 开发指南","date":"2025-06-20T00:00:00.000Z","description":"Video.js Component 基础概念 什么是 Video.js Component？ Video.js Component 是基于 Video.js Player 框架的可扩展 UI 元素，用于增强视频播放器的功能和用户体验。每个 Component 都是独立的、可重用的模块。 Component 继承关系 核心 API Component ...","head":[["meta",{"property":"og:url","content":"https://dribble-njr.github.io/blog/blog/frontend/practice/022-videojs-component.html"}],["meta",{"property":"og:title","content":"Video.js Component 开发指南"}],["meta",{"property":"og:description","content":"Video.js Component 基础概念 什么是 Video.js Component？ Video.js Component 是基于 Video.js Player 框架的可扩展 UI 元素，用于增强视频播放器的功能和用户体验。每个 Component 都是独立的、可重用的模块。 Component 继承关系 核心 API Component ..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-06-20T03:26:47.000Z"}],["meta",{"property":"article:author","content":"njr"}],["meta",{"property":"article:published_time","content":"2025-06-20T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-06-20T03:26:47.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Video.js Component 开发指南\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2025-06-20T00:00:00.000Z\\",\\"dateModified\\":\\"2025-06-20T03:26:47.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"njr\\",\\"url\\":\\"https://github.com/dribble-njr/blog\\",\\"email\\":\\"wzw15292257101@163.com\\"}]}"]]},"headers":[{"level":2,"title":"1 Video.js Component 基础概念","slug":"video-js-component-基础概念","link":"#video-js-component-基础概念","children":[{"level":3,"title":"1.1 什么是 Video.js Component？","slug":"什么是-video-js-component","link":"#什么是-video-js-component","children":[]},{"level":3,"title":"1.2 Component 继承关系","slug":"component-继承关系","link":"#component-继承关系","children":[]},{"level":3,"title":"1.3 核心 API","slug":"核心-api","link":"#核心-api","children":[]}]},{"level":2,"title":"2 Component 设计理念","slug":"component-设计理念","link":"#component-设计理念","children":[{"level":3,"title":"2.1 1. 单一职责原则","slug":"_1-单一职责原则","link":"#_1-单一职责原则","children":[]},{"level":3,"title":"2.2 2. Component 通信模式","slug":"_2-component-通信模式","link":"#_2-component-通信模式","children":[]},{"level":3,"title":"2.3 3. 事件驱动架构","slug":"_3-事件驱动架构","link":"#_3-事件驱动架构","children":[]}]},{"level":2,"title":"3 Component 生命周期","slug":"component-生命周期","link":"#component-生命周期","children":[{"level":3,"title":"3.1 生命周期详解","slug":"生命周期详解","link":"#生命周期详解","children":[]}]},{"level":2,"title":"4 实战案例：Countdown Component","slug":"实战案例-countdown-component","link":"#实战案例-countdown-component","children":[{"level":3,"title":"4.1 功能需求","slug":"功能需求","link":"#功能需求","children":[]},{"level":3,"title":"4.2 实现代码","slug":"实现代码","link":"#实现代码","children":[]},{"level":3,"title":"4.3 技术要点","slug":"技术要点","link":"#技术要点","children":[]}]},{"level":2,"title":"5 实战案例：Progress Bar Component","slug":"实战案例-progress-bar-component","link":"#实战案例-progress-bar-component","children":[{"level":3,"title":"5.1 功能需求","slug":"功能需求-1","link":"#功能需求-1","children":[]},{"level":3,"title":"5.2 实现代码","slug":"实现代码-1","link":"#实现代码-1","children":[]},{"level":3,"title":"5.3 技术要点","slug":"技术要点-1","link":"#技术要点-1","children":[]}]},{"level":2,"title":"6 实战案例：Progress Overlay Component","slug":"实战案例-progress-overlay-component","link":"#实战案例-progress-overlay-component","children":[{"level":3,"title":"6.1 功能需求","slug":"功能需求-2","link":"#功能需求-2","children":[]},{"level":3,"title":"6.2 实现代码","slug":"实现代码-2","link":"#实现代码-2","children":[]},{"level":3,"title":"6.3 技术要点","slug":"技术要点-2","link":"#技术要点-2","children":[]}]},{"level":2,"title":"7 使用","slug":"使用","link":"#使用","children":[]},{"level":2,"title":"8 总结","slug":"总结","link":"#总结","children":[]}],"git":{"createdTime":1750390007000,"updatedTime":1750390007000,"contributors":[{"name":"dribble-njr","email":"wzw15292257101@163.com","commits":1}]},"readingTime":{"minutes":6,"words":1800},"filePathRelative":"frontend/practice/022-videojs-component.md","localizedDate":"2025年6月20日","excerpt":"","autoDesc":true}');export{d as comp,v as data};
