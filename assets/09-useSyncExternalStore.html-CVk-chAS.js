import{_ as o,c as p,e as c,a as s,d as a,b as e,r as l,o as i}from"./app-CMUwc0b2.js";const u={},r={href:"https://react.dev/reference/react/useSyncExternalStore",target:"_blank",rel:"noopener noreferrer"},d={href:"https://react.dev/reference/react-dom/server",target:"_blank",rel:"noopener noreferrer"};function k(v,n){const t=l("ExternalLinkIcon");return i(),p("div",null,[n[4]||(n[4]=c(`<p>ä¸æ˜¯æ‰€æœ‰çš„ä¸œè¥¿éƒ½æ˜¯ç”¨ React æ„å»ºçš„ã€‚æœ‰å¾ˆå¤šåº“å’Œå¹³å° API æ˜¯å¤–éƒ¨äº React çš„ã€‚å°†è¿™äº›ä¸œè¥¿å¼•å…¥ React çš„ç»„ä»¶æ¨¡å‹å’ŒçŠ¶æ€ç®¡ç†ç”Ÿå‘½å‘¨æœŸæ˜¯æ„å»ºå…¨åŠŸèƒ½åº”ç”¨ç¨‹åºçš„å¿…è¦æ¡ä»¶ã€‚</p><p>ä»»åŠ¡æ˜¯åŒæ­¥å¤–éƒ¨ä¸–ç•Œä¸ React ç»„ä»¶çš„å†…éƒ¨çŠ¶æ€ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>useSyncExternalStore</code> é’©å­ã€‚</p><p>è®©æˆ‘ä»¬ä»¥ä¸€ä¸ªç»„ä»¶ä¸ºä¾‹ï¼Œè¯¥ç»„ä»¶é€šè¿‡ geolocation API æ˜¾ç¤ºæ‚¨çš„å½“å‰ä½ç½®ã€‚geolocation API ä¸æ˜¯ React çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åŒæ­¥ geolocation API çš„å¤–éƒ¨çŠ¶æ€ä¸ç»„ä»¶çš„å†…éƒ¨çŠ¶æ€ã€‚</p><div class="language-tsx line-numbers-mode" data-ext="tsx" data-title="tsx"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useSyncExternalStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span>

<span class="token keyword">type</span> <span class="token class-name">LocationData</span> <span class="token operator">=</span>
	<span class="token operator">|</span> <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&#39;unavailable&#39;</span><span class="token punctuation">;</span> geo<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">never</span> <span class="token punctuation">}</span>
	<span class="token operator">|</span> <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&#39;available&#39;</span><span class="token punctuation">;</span> geo<span class="token operator">:</span> GeolocationPosition <span class="token punctuation">}</span>
<span class="token comment">// this variable is our external store!</span>
<span class="token keyword">let</span> location<span class="token operator">:</span> LocationData <span class="token operator">=</span> <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&#39;unavailable&#39;</span> <span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">subscribeToGeolocation</span><span class="token punctuation">(</span><span class="token function-variable function">callback</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> watchId <span class="token operator">=</span> navigator<span class="token punctuation">.</span>geolocation<span class="token punctuation">.</span><span class="token function">watchPosition</span><span class="token punctuation">(</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		location <span class="token operator">=</span> <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&#39;available&#39;</span><span class="token punctuation">,</span> geo<span class="token operator">:</span> position <span class="token punctuation">}</span>
		<span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		location <span class="token operator">=</span> <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&#39;unavailable&#39;</span> <span class="token punctuation">}</span>
		<span class="token keyword">return</span> navigator<span class="token punctuation">.</span>geolocation<span class="token punctuation">.</span><span class="token function">clearWatch</span><span class="token punctuation">(</span>watchId<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">getGeolocationSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> location
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">MyLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> location <span class="token operator">=</span> <span class="token function">useSyncExternalStore</span><span class="token punctuation">(</span>
		subscribeToGeolocation<span class="token punctuation">,</span>
		getGeolocationSnapshot<span class="token punctuation">,</span>
	<span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
			</span><span class="token punctuation">{</span>location<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">&#39;unavailable&#39;</span> <span class="token operator">?</span> <span class="token punctuation">(</span>
				<span class="token string">&#39;Your location is unavailable&#39;</span>
			<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
					Your location is </span><span class="token punctuation">{</span>location<span class="token punctuation">.</span>geo<span class="token punctuation">.</span>coords<span class="token punctuation">.</span>latitude<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
					</span><span class="token punctuation">{</span><span class="token string">&#39;Â°, &#39;</span><span class="token punctuation">}</span><span class="token plain-text">
					</span><span class="token punctuation">{</span>location<span class="token punctuation">.</span>geo<span class="token punctuation">.</span>coords<span class="token punctuation">.</span>longitude<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
					</span><span class="token punctuation">{</span><span class="token string">&#39;Â°&#39;</span><span class="token punctuation">}</span><span class="token plain-text">
				</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
		</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
	<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åŸºæœ¬ API å¦‚ä¸‹ï¼š</p><div class="language-tsx line-numbers-mode" data-ext="tsx" data-title="tsx"><pre class="language-tsx"><code><span class="token keyword">const</span> snapshot <span class="token operator">=</span> <span class="token function">useSyncExternalStore</span><span class="token punctuation">(</span>
	subscribe<span class="token punctuation">,</span>
	getSnapshot<span class="token punctuation">,</span>
	getServerSnapshot<span class="token punctuation">,</span> <span class="token comment">// optional</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>subscribe</code> æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ªå›è°ƒå‡½æ•°å¹¶è¿”å›ä¸€ä¸ªæ¸…ç†å‡½æ•°ã€‚æ¯å½“å¤–éƒ¨å­˜å‚¨å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå›è°ƒå‡½æ•°éƒ½ä¼šè¢«è°ƒç”¨ï¼Œè®© React çŸ¥é“åº”è¯¥è°ƒç”¨ <code>getSnapshot</code> æ¥è·å–æ–°å€¼ã€‚</li><li><code>getSnapshot</code> æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒè¿”å›å¤–éƒ¨å­˜å‚¨çš„å½“å‰å€¼ã€‚</li><li><code>getServerSnapshot</code> æ˜¯ä¸€ä¸ªå¯é€‰å‡½æ•°ï¼Œå®ƒä»æœåŠ¡å™¨è¿”å›å¤–éƒ¨å­˜å‚¨çš„å½“å‰å€¼ã€‚è¿™å¯¹äºæœåŠ¡å™¨ç«¯æ¸²æŸ“å’Œé‡æ–°æ°´åˆå¾ˆæœ‰ç”¨ã€‚å¦‚æœæ‚¨ä¸æä¾›æ­¤å‡½æ•°ï¼Œåˆ™ React å°†åœ¨æœåŠ¡å™¨ä¸Šæ¸²æŸ“æœ€è¿‘çš„ <code>Suspense</code> è¾¹ç•Œ <code>fallback</code>ï¼Œç„¶åå½“å®¢æˆ·ç«¯æ°´åˆæ—¶ï¼Œå®ƒå°†è°ƒç”¨ <code>getSnapshot</code> æ¥è·å–å½“å‰å€¼ã€‚</li></ul><p>å‚è€ƒæ–‡æ¡£ï¼š</p>`,8)),s("ul",null,[s("li",null,[s("a",r,[n[0]||(n[0]=a("ğŸ“œ ",-1)),n[1]||(n[1]=s("code",null,"useSyncExternalStore",-1)),n[2]||(n[2]=a(" docs",-1)),e(t)])]),s("li",null,[s("a",d,[n[3]||(n[3]=a("ğŸ“œ SSR docs",-1)),e(t)])])])])}const b=o(u,[["render",k],["__file","09-useSyncExternalStore.html.vue"]]),g=JSON.parse('{"path":"/frontend/framework/react/09-useSyncExternalStore.html","title":"useSyncExternalStore","lang":"zh-CN","frontmatter":{"title":"useSyncExternalStore","date":"2025-08-05T00:00:00.000Z","tags":["react","hooks"],"description":"ä¸æ˜¯æ‰€æœ‰çš„ä¸œè¥¿éƒ½æ˜¯ç”¨ React æ„å»ºçš„ã€‚æœ‰å¾ˆå¤šåº“å’Œå¹³å° API æ˜¯å¤–éƒ¨äº React çš„ã€‚å°†è¿™äº›ä¸œè¥¿å¼•å…¥ React çš„ç»„ä»¶æ¨¡å‹å’ŒçŠ¶æ€ç®¡ç†ç”Ÿå‘½å‘¨æœŸæ˜¯æ„å»ºå…¨åŠŸèƒ½åº”ç”¨ç¨‹åºçš„å¿…è¦æ¡ä»¶ã€‚ ä»»åŠ¡æ˜¯åŒæ­¥å¤–éƒ¨ä¸–ç•Œä¸ React ç»„ä»¶çš„å†…éƒ¨çŠ¶æ€ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨ useSyncExternalStore é’©å­ã€‚ è®©æˆ‘ä»¬ä»¥ä¸€ä¸ªç»„ä»¶ä¸ºä¾‹ï¼Œè¯¥ç»„ä»¶é€šè¿‡ geolocation...","head":[["meta",{"property":"og:url","content":"https://dribble-njr.github.io/blog/blog/frontend/framework/react/09-useSyncExternalStore.html"}],["meta",{"property":"og:title","content":"useSyncExternalStore"}],["meta",{"property":"og:description","content":"ä¸æ˜¯æ‰€æœ‰çš„ä¸œè¥¿éƒ½æ˜¯ç”¨ React æ„å»ºçš„ã€‚æœ‰å¾ˆå¤šåº“å’Œå¹³å° API æ˜¯å¤–éƒ¨äº React çš„ã€‚å°†è¿™äº›ä¸œè¥¿å¼•å…¥ React çš„ç»„ä»¶æ¨¡å‹å’ŒçŠ¶æ€ç®¡ç†ç”Ÿå‘½å‘¨æœŸæ˜¯æ„å»ºå…¨åŠŸèƒ½åº”ç”¨ç¨‹åºçš„å¿…è¦æ¡ä»¶ã€‚ ä»»åŠ¡æ˜¯åŒæ­¥å¤–éƒ¨ä¸–ç•Œä¸ React ç»„ä»¶çš„å†…éƒ¨çŠ¶æ€ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨ useSyncExternalStore é’©å­ã€‚ è®©æˆ‘ä»¬ä»¥ä¸€ä¸ªç»„ä»¶ä¸ºä¾‹ï¼Œè¯¥ç»„ä»¶é€šè¿‡ geolocation..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-08-15T08:49:38.000Z"}],["meta",{"property":"article:author","content":"njr"}],["meta",{"property":"article:tag","content":"react"}],["meta",{"property":"article:tag","content":"hooks"}],["meta",{"property":"article:published_time","content":"2025-08-05T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-08-15T08:49:38.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"useSyncExternalStore\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2025-08-05T00:00:00.000Z\\",\\"dateModified\\":\\"2025-08-15T08:49:38.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"njr\\",\\"url\\":\\"https://github.com/dribble-njr/blog\\",\\"email\\":\\"wzw15292257101@163.com\\"}]}"]]},"headers":[],"git":{"createdTime":1755247778000,"updatedTime":1755247778000,"contributors":[{"name":"dribble-njr","email":"wzw15292257101@163.com","commits":1}]},"readingTime":{"minutes":1.42,"words":425},"filePathRelative":"frontend/framework/react/09-useSyncExternalStore.md","localizedDate":"2025å¹´8æœˆ5æ—¥","excerpt":"","autoDesc":true}');export{b as comp,g as data};
